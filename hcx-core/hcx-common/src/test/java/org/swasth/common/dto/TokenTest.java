package org.swasth.common.dto;

import org.junit.Test;

import static org.junit.Assert.assertEquals;
import static org.junit.Assert.assertTrue;

public class TokenTest {

    @Test
    public void testJWTTokenWithoutBearer() throws Exception {
        Token token = new Token("eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICI3Q1l0Z2VYMzA2NEQ3VUU0czdCQWlJZmUzN3hxczBtNEVSQnpmdzVuMzdNIn0.eyJleHAiOjE2ODQ5OTExNjgsImlhdCI6MTY4MzI2MzE2OCwianRpIjoiN2ZiYjEwMDYtYTVhNS00ZDBkLTg5OGUtMTEzYmM1NWMwNTA1IiwiaXNzIjoiaHR0cDovL2Rldi1oY3guc3dhc3RoLmFwcC9hdXRoL3JlYWxtcy9zd2FzdGgtaGVhbHRoLWNsYWltLWV4Y2hhbmdlIiwic3ViIjoiODUyNzg1M2MtYjQ0Mi00NGRiLWFlZGEtZGJiZGNmNDcyZDliIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoicmVnaXN0cnktZnJvbnRlbmQiLCJzZXNzaW9uX3N0YXRlIjoiZDMwZTlmOWItOGI1OC00ZjFjLTgyMGEtYjM1YmVhNGI2ZTJkIiwiYWNyIjoiMSIsInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJwcm92aWRlciIsImRlZmF1bHQtcm9sZXMtbmRlYXIiXX0sInNjb3BlIjoicHJvZmlsZSBlbWFpbCIsImVtYWlsX3ZlcmlmaWVkIjpmYWxzZSwicHJlZmVycmVkX3VzZXJuYW1lIjoidGVzdHByb3ZpZGVyMUBhcG9sbG8uY29tIiwiZW50aXR5IjpbIk9yZ2FuaXNhdGlvbiJdLCJlbWFpbCI6InRlc3Rwcm92aWRlcjFAYXBvbGxvLmNvbSJ9.Ob8AaHB6RJdcXP5WEVpHkYBTTYfKQO_iu9pFRCuu9tA7cGPr2ZF7ZMyUGHe6jZVkb2d_Je7co-wmD-GW2xoL1W1uoD8cUkJo8yegYM1ItRD0pmHlvjLo4m79hWva4LJpv6a_CK0ZrjMmfHwgQiLNv4LTv9GPMUIFP-oLbfcPt3rUczOSelO_irJJgBbJJwEP3Gd44Orx4rlYm5Mx7TbK2NDt9rR8tZREb4MBH5nsf0E4odwp65_NHvlc9IR630GLOvX1kXwyqSNIJozoYZfcLk03rN5b7IFwQuhjf_Iamd9dsBZD_J2yxrX362a9M9_kF5QUPZx4hrihPY-iCD1DYg");
        assertTrue(token.getHeaders().containsKey("alg"));
        assertTrue(token.getPayload().containsKey("preferred_username"));
        assertTrue(token.getRoles().contains("provider"));
        assertEquals("testprovider1@apollo.com", token.getUsername());
    }

    @Test
    public void testJWTTokenWithBearer() throws Exception {
        Token token = new Token("Bearer eyJhbGciOiJSUzI1NiJ9.eyJzdWIiOiI2ZGI4NDg2NS1iM2ZmLTQwYjMtOTg0ZS05ODMxMmVhMDRkM2EiLCJyZXNvdXJjZV9hY2Nlc3MiOnsiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJpc3MiOiJodHRwOlwvXC9rZXljbG9hay5rZXljbG9hay5zdmMuY2x1c3Rlci5sb2NhbDo4MDgwXC9hdXRoXC9yZWFsbXNcL3N3YXN0aC1oY3gtdXNlcnMiLCJ0eXAiOiJCZWFyZXIiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJoY3h0ZXN0NzAzN0B5b3BtYWlsLmNvbSIsImF1ZCI6ImFjY291bnQiLCJhY3IiOiIxIiwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtc3dhc3RoLWhlYWx0aC1jbGFpbS1leGNoYW5nZS11c2VyIiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdLCJ0ZW5hbnRfcm9sZXMiOlt7InJvbGUiOiJhZG1pbiIsInBhcnRpY2lwYW50X2NvZGUiOiJoY3h0ZXN0NzAzNi55b3BtYWlsQHN3YXN0aC1oY3gtZGV2In1dfSwidXNlcl9pZCI6ImhjeHRlc3Q3MDM3QHlvcG1haWwuY29tIiwiYXpwIjoicmVnaXN0cnktZnJvbnRlbmQiLCJzY29wZSI6ImVtYWlsIHByb2ZpbGUiLCJleHAiOjE2ODc5MDIzMjgsInNlc3Npb25fc3RhdGUiOiIyZTBlNDc2NS1lYTViLTRmMGQtOTU2ZS0xZmUyNmExYTJmNjYiLCJpYXQiOjE2ODc4NjYzMjgsImp0aSI6IjUzNjcxYmM2LWQ1NzgtNDA2OS04M2JmLWEyODY4NjAwZGEwYiIsImVtYWlsIjoiaGN4dGVzdDcwMzdAeW9wbWFpbC5jb20iLCJlbnRpdHkiOlsiVXNlciJdfQ.wK6nwZE8Ty7NW3qoDaJSQzmhidq7iNU5ka_bLG_JE77NqYlHPfZKOFHDt2FoxS9HGklLtwvdLyDaL21J1L6U48I6OKdu_D1XcvYnuHBGCFnj6VWju4K2SxdOW86J-8_03cgtryuga4PEimoKe637-dfeaiMnv7N3Mc-GGf3JFZonW2fhPx7aN7lz8PVLyFLNsunKOdpfCjmItd_QE-ToG8mTlHeeDA6tKx92NJUq19YsYVvUR84qd5h1s2AOmjgqRr28synDEjVZaqTzk5bxaNCy5zIOTwob4ghxKvO2TmgTwXVaHVltzrL20ALjICtPCkqQh5lOTBJt0bMKeLEKlQ");
        assertEquals("eyJhbGciOiJSUzI1NiJ9.eyJzdWIiOiI2ZGI4NDg2NS1iM2ZmLTQwYjMtOTg0ZS05ODMxMmVhMDRkM2EiLCJyZXNvdXJjZV9hY2Nlc3MiOnsiYWNjb3VudCI6eyJyb2xlcyI6WyJtYW5hZ2UtYWNjb3VudCIsIm1hbmFnZS1hY2NvdW50LWxpbmtzIiwidmlldy1wcm9maWxlIl19fSwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJpc3MiOiJodHRwOlwvXC9rZXljbG9hay5rZXljbG9hay5zdmMuY2x1c3Rlci5sb2NhbDo4MDgwXC9hdXRoXC9yZWFsbXNcL3N3YXN0aC1oY3gtdXNlcnMiLCJ0eXAiOiJCZWFyZXIiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJoY3h0ZXN0NzAzN0B5b3BtYWlsLmNvbSIsImF1ZCI6ImFjY291bnQiLCJhY3IiOiIxIiwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtc3dhc3RoLWhlYWx0aC1jbGFpbS1leGNoYW5nZS11c2VyIiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdLCJ0ZW5hbnRfcm9sZXMiOlt7InJvbGUiOiJhZG1pbiIsInBhcnRpY2lwYW50X2NvZGUiOiJoY3h0ZXN0NzAzNi55b3BtYWlsQHN3YXN0aC1oY3gtZGV2In1dfSwidXNlcl9pZCI6ImhjeHRlc3Q3MDM3QHlvcG1haWwuY29tIiwiYXpwIjoicmVnaXN0cnktZnJvbnRlbmQiLCJzY29wZSI6ImVtYWlsIHByb2ZpbGUiLCJleHAiOjE2ODc5MDIzMjgsInNlc3Npb25fc3RhdGUiOiIyZTBlNDc2NS1lYTViLTRmMGQtOTU2ZS0xZmUyNmExYTJmNjYiLCJpYXQiOjE2ODc4NjYzMjgsImp0aSI6IjUzNjcxYmM2LWQ1NzgtNDA2OS04M2JmLWEyODY4NjAwZGEwYiIsImVtYWlsIjoiaGN4dGVzdDcwMzdAeW9wbWFpbC5jb20iLCJlbnRpdHkiOlsiVXNlciJdfQ.wK6nwZE8Ty7NW3qoDaJSQzmhidq7iNU5ka_bLG_JE77NqYlHPfZKOFHDt2FoxS9HGklLtwvdLyDaL21J1L6U48I6OKdu_D1XcvYnuHBGCFnj6VWju4K2SxdOW86J-8_03cgtryuga4PEimoKe637-dfeaiMnv7N3Mc-GGf3JFZonW2fhPx7aN7lz8PVLyFLNsunKOdpfCjmItd_QE-ToG8mTlHeeDA6tKx92NJUq19YsYVvUR84qd5h1s2AOmjgqRr28synDEjVZaqTzk5bxaNCy5zIOTwob4ghxKvO2TmgTwXVaHVltzrL20ALjICtPCkqQh5lOTBJt0bMKeLEKlQ",token.getToken() );
        assertEquals("User",token.getEntityType());
        assertEquals("hcxtest7037@yopmail.com",token.getUserId());
        assertEquals("6db84865-b3ff-40b3-984e-98312ea04d3a",token.getSubject());
        assertTrue(token.getTenantRoles().size() > 0);
    }

    @Test
    public void testInviteToken() throws Exception {
        Token token = new Token("eyJ0eXBlIjoiand0IiwiYWxnIjoiUlMyNTYifQ.eyJyb2xlIjoidmlld2VyIiwicGFydGljaXBhbnRfY29kZSI6ImhjeHRlc3QyMC55b3BtYWlsQHN3YXN0aC1oY3giLCJpc3MiOiJoY3hnYXRld2F5LnN3YXN0aEBzd2FzdGgtaGN4LWRldiIsInR5cCI6Imludml0ZSIsImludml0ZWRfYnkiOiJoY3h0ZXN0MjBAeW9wbWFpbC5jb20iLCJleHAiOjE2ODc5NDMwNDM0MTQsImlhdCI6MTY4Nzg1NjY0MzQxNCwianRpIjoiOTc3OTg1NDQtNWY4NC00ZDMxLThlMzgtZTcyZDVjYTUxZjNlIiwiZW1haWwiOiJoY3h0ZXN0MjJAeW9wbWFpbC5jb20ifQ.1rgBhbqYV9uWpRcWLGjKnjYvdu3vDrhIWXZPoVf_OPQOGO4huHJifnQheFv8xaQhdOmpSmGY9Awm4_qO1gXIg-pEKqbcWbRHG1x8GNjUb57zOctJa7Uki92LWmCE0UB-cnERebEGM8in0W-ZObgeAsH7gKwRbWJPQHxFyyQYKpkgJHFiMI7S3erLpNyp0kGyh6xSdvxog27fCmnZVI9AZbVt1_xo9cQedCLD9Ez6tG99Bc-fytcg8-FTbYc3hglbU6zXizkfynrbZ3bX5FXptu1cRj5ymB93uHCl9G5XeKRSkwl-C9eYEbIDvMKXjChLnA1fQAHo4oS3ztWcV6zxmg");
        assertEquals( "viewer",token.getRole());
        assertEquals( "hcxtest20.yopmail@swasth-hcx",token.getParticipantCode());
        assertEquals( "hcxtest20@yopmail.com",token.getInvitedBy());
    }


}
